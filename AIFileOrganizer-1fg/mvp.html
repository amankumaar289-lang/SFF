<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPACE-Конструктор: Цифровая Учётная Политика</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: #1e3a8a;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #64748b;
            font-size: 1.1rem;
        }

        .header .team {
            margin-top: 15px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            display: inline-block;
            font-weight: bold;
        }

        .main-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 500px;
        }

        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .wizard-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e2e8f0;
            z-index: 0;
        }

        .wizard-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .wizard-step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #94a3b8;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .wizard-step.active .wizard-step-circle {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .wizard-step.completed .wizard-step-circle {
            background: #10b981;
            color: white;
        }

        .wizard-step-label {
            font-size: 0.9rem;
            color: #64748b;
        }

        .wizard-step.active .wizard-step-label {
            color: #1e3a8a;
            font-weight: bold;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .step-title {
            font-size: 2rem;
            color: #1e3a8a;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #334155;
            font-weight: 600;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .wizard-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
        }

        .section-card {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .section-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .section-card.selected {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .section-number {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: bold;
            margin-right: 15px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e3a8a;
            flex: 1;
        }

        .section-content {
            color: #64748b;
            line-height: 1.6;
            margin-top: 10px;
        }

        .checkbox-container {
            display: flex;
            align-items: flex-start;
            cursor: pointer;
        }

        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            margin-top: 2px;
            cursor: pointer;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge-budget {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-accounting {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-industry {
            background: #e0e7ff;
            color: #4338ca;
        }

        .info-box {
            background: #f0f9ff;
            border-left: 4px solid #0284c7;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box strong {
            color: #075985;
        }

        .summary-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: #64748b;
            font-weight: 600;
        }

        .summary-value {
            color: #1e3a8a;
            font-weight: bold;
        }

        .success-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            font-size: 3rem;
        }

        .policy-preview {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 30px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .policy-preview h3 {
            color: #1e3a8a;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .policy-preview p {
            color: #475569;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .home-content {
            text-align: center;
            padding: 40px 20px;
        }

        .home-content h2 {
            color: #1e3a8a;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .home-content p {
            color: #64748b;
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .feature-item {
            background: #f8fafc;
            padding: 25px;
            border-radius: 10px;
            text-align: left;
        }

        .feature-item h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .feature-item p {
            color: #64748b;
            font-size: 1rem;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .api-note {
            background: #fff7ed;
            border-left: 4px solid #f97316;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #7c2d12;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏗️ SPACE-Конструктор</h1>
            <div class="subtitle">Цифровая система создания учётных политик для государственных организаций Москвы</div>
            <div class="team">Команда SPACE: Захар Кондратьев, Никита Мусиенко</div>
        </div>

        <div class="main-card" id="app">
            <div class="loading">
                <div class="spinner"></div>
                <p>Загрузка приложения...</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // MOCK API LAYER - READY FOR 1C INTEGRATION
        // ============================================================================
        // В production это будет заменено на реальные API вызовы к системе 1С
        // Все функции имеют такую же сигнатуру, как реальные API endpoints
        // ============================================================================

        class MockAPI {
            constructor() {
                this.initializeData();
            }

            initializeData() {
                // Проверяем, есть ли данные в localStorage
                if (!localStorage.getItem('organizations')) {
                    // Инициализируем данные из системы (в реальности - из 1С)
                    const initialData = {
                        organizations: [
                            {
                                id: 1,
                                name: "Департамент природы и охраны окружающей среды города Москвы",
                                inn: "7700258755",
                                kpp: "770101001",
                                accountingType: "budget",
                                industry: "Окружающая среда",
                                centralizedOffice: "ГКУ «ЦБ природоохраны»"
                            },
                            {
                                id: 2,
                                name: "Департамент финансов города Москвы",
                                inn: "7707079518",
                                kpp: "770101001",
                                accountingType: "budget",
                                industry: null,
                                centralizedOffice: "ГКУ «МЦБУ»"
                            },
                            {
                                id: 3,
                                name: "ГБУ Жилищник района",
                                inn: "7922591577",
                                kpp: "770301001",
                                accountingType: "accounting",
                                industry: "Жилищно-коммунальное хозяйство",
                                centralizedOffice: "ГКУ «ЦБ ДЖКХ»"
                            },
                            {
                                id: 4,
                                name: "ГБУ Школа здоровья",
                                inn: "7789010031",
                                kpp: "770101001",
                                accountingType: "accounting",
                                industry: "Образование",
                                centralizedOffice: "ГКУ «ЦБ ДОНМ»"
                            },
                            {
                                id: 5,
                                name: "ГАУ Новации и кадры",
                                inn: "7765230100",
                                kpp: "770301001",
                                accountingType: "accounting",
                                industry: null,
                                centralizedOffice: "ГКУ «ЦБ предпринимательства»"
                            }
                        ],
                        policySections: [
                            {
                                id: 1,
                                sectionNumber: "1.1.1",
                                title: "Общие положения",
                                content: "Учетная политика субъекта централизованного учета для целей бюджетного/бухгалтерского учета (далее – учетная политика) сформирована в соответствии с требованиями законодательства Российской Федерации о бухгалтерском учете, федеральных стандартов бухгалтерского учета государственных финансов, иными нормативными правовыми актами и разъяснениями уполномоченных органов государственной власти Российской Федерации, города Москвы, регулирующими порядок организации и ведения учета, составления отчетности.\n\nВ состав учетной политики включены следующие приложения:\nприложение 1 «Рабочий план счетов бухгалтерского учета»;\nприложение 2 «Альбом неунифицированных форм первичной учетной документации»;\nприложение 3 «График документооборота»;\nприложение 4 «Положение об инвентаризации активов и обязательств»;\nприложение 5 «Положение о комиссии по поступлению и выбытию активов»;\nприложение 6 «Корреспонденция счетов бухгалтерского учета фактов хозяйственной жизни»;\nприложение 7 «Положение о расчетах с подотчетными лицами».\n\nУчетная политика формируется централизованной бухгалтерией, утверждается руководителем централизованной бухгалтерии и размещается на официальном сайте централизованной бухгалтерии в информационно-телекоммуникационной сети Интернет.",
                                budgetAccounting: true,
                                businessAccounting: true,
                                industrySpecific: false,
                                industries: null
                            },
                            {
                                id: 2,
                                sectionNumber: "1.1.2",
                                title: "Порядок внесения изменений в учетную политику",
                                content: "При необходимости внесения изменений в учетную политику, в том числе по инициативе субъекта централизованного учета (например, при изменении условий деятельности, эксплуатации активов, критериев оценки и т.п.), а также в связи с изменениями законодательства Российской Федерации о бухгалтерском учете, нормативных правовых актов, регулирующих ведение учета и составление отчетности, централизованная бухгалтерия разрабатывает проект изменений в стандартизированную учетную политику для целей бюджетного/бухгалтерского учета органов исполнительной власти и государственных учреждений города Москвы.\n\nИзменения в учетную политику оформляются отдельным приказом руководителя централизованной бухгалтерии одним из указанных способов:\n- В случае если изменения кардинально изменяют первоначальные положения учетной политики - утверждается новая редакция учетной политики с отменой старой. Кардинальными считаются изменения, затрагивающие более 50 процентов текста или разделов учетной политики.\n- В иных случаях изменения оформляются путем их внесения в действующую редакцию учетной политики.",
                                budgetAccounting: true,
                                businessAccounting: true,
                                industrySpecific: false,
                                industries: null
                            },
                            {
                                id: 3,
                                sectionNumber: "1.1.3",
                                title: "Оценочные значения",
                                content: "Оценочные значения показателя, необходимого для ведения учета и/или отражаемого в отчетности, рассчитываются (оценочно определяются) основываясь, в том числе, на профессиональных суждениях ответственных должностных лиц субъекта централизованного учета, централизованной бухгалтерии, полномочных (компетентных) принимать решения в тех или иных вопросах, обладающих специальными знаниями, опытом, а при отсутствии таких лиц – на основании экспертных заключений специализированных организаций.\n\nПрофессиональное суждение выносится специалистом (должностным лицом) с учетом требований нормативных правовых актов, регулирующих вопросы предметной области, в отношении которой определяется оценочное значение, специфики деятельности субъекта централизованного учета, а также положений настоящей учетной политики.",
                                budgetAccounting: true,
                                businessAccounting: true,
                                industrySpecific: false,
                                industries: null
                            },
                            {
                                id: 4,
                                sectionNumber: "1.2",
                                title: "Организация учета",
                                content: "Учет субъекта централизованного учета ведется автоматизированным способом на базе универсальной автоматизированной системы бюджетного учета (платформа «1С») посредством использования централизованной бухгалтерией и субъектами централизованного учета статусной модели, реализуемой путем настройки Департаментом информационных технологий города Москвы функциональных блоков (подсистем) в соответствии с Соглашением.\n\nУчет субъекта централизованного учета ведется в соответствии с Рабочим планом счетов бухгалтерского учета, содержащим синтетические и аналитические счета, разработанным на основе Единого плана счетов бухгалтерского учета для органов государственной власти.",
                                budgetAccounting: true,
                                businessAccounting: true,
                                industrySpecific: false,
                                industries: null
                            },
                            {
                                id: 5,
                                sectionNumber: "1.3",
                                title: "Правила документооборота и технология обработки учетной информации",
                                content: "Для ведения учета применяются:\n- унифицированные формы первичных учетных документов, утвержденные приказом Минфина России от 30.03.2015 № 52н;\n- унифицированные формы первичных учетных документов, утвержденные приказом Минфина России от 15.04.2021 № 61н;\n- иные унифицированные формы первичных документов, утвержденные уполномоченными государственными органами;\n- самостоятельно разработанные формы документов, содержащие обязательные реквизиты.\n\nПорядок нумерации отдельных видов документов устанавливается в зависимости от типа документа с возобновлением нумерации в начале года.",
                                budgetAccounting: true,
                                businessAccounting: true,
                                industrySpecific: false,
                                industries: null
                            },
                            {
                                id: 6,
                                sectionNumber: "2.1.1.2.4",
                                title: "Объекты благоустройства",
                                content: "В соответствии с нормами Закона г. Москвы от 30.04.2014 № 18 «О благоустройстве в городе Москве» объектами благоустройства являются: территория города Москвы с расположенными на ней элементами объектов благоустройства, внешние поверхности зданий, строений, сооружений (в том числе крыши, фасады), объекты, не являющиеся объектами капитального строительства.\n\nК элементам объектов благоустройства относятся конструктивные и функциональные составляющие объектов благоустройства, определяющие их внешний вид, обеспечивающие визуальное восприятие объектов благоустройства.\n\nК работам по благоустройству территории относятся: устройство покрытий (асфальтирование, укладка плитки), озеленение (газоны, клумбы), устройство освещения, инженерная подготовка, установка малых архитектурных форм (детские и спортивные комплексы, скамейки, урны, ограждения).",
                                budgetAccounting: true,
                                businessAccounting: true,
                                industrySpecific: true,
                                industries: ["Жилищно-коммунальное хозяйство", "Транспорт", "Дорожное хозяйство"]
                            },
                            {
                                id: 7,
                                sectionNumber: "1.3.2",
                                title: "Особенности применения первичных документов",
                                content: "Извещение (ф. 0504805) оформляется как первичный учетный документ в целях отражения взаимосвязанных операций, возникающих при расчетах между администратором доходов по начислению доходов и администратором, осуществляющим полномочия по администрированию кассовых поступлений.\n\nБухгалтерская справка (ф. 0504833) составляется для отражения в учете совершаемых операций в следующих случаях: при перерегистрации обязательств, при принятии к учету права пользования активом, при исправлении ошибок в учете, при формировании резерва предстоящих расходов.\n\nРасчетные листки формируются централизованной бухгалтерией в УАИС Бюджетный учет. Выдача расчетных листков работникам субъекта централизованного учета осуществляется в порядке, установленном Соглашением.",
                                budgetAccounting: true,
                                businessAccounting: true,
                                industrySpecific: false,
                                industries: null
                            }
                        ],
                        generatedPolicies: [],
                        nextOrganizationId: 6,
                        nextPolicyId: 1
                    };

                    localStorage.setItem('organizations', JSON.stringify(initialData.organizations));
                    localStorage.setItem('policySections', JSON.stringify(initialData.policySections));
                    localStorage.setItem('generatedPolicies', JSON.stringify(initialData.generatedPolicies));
                    localStorage.setItem('nextOrganizationId', initialData.nextOrganizationId);
                    localStorage.setItem('nextPolicyId', initialData.nextPolicyId);
                }
            }

            // ========================================================================
            // INTEGRATION POINT: GET /api/organizations
            // В production: заменить на fetch('https://1c-api.moscow.ru/api/organizations')
            // ========================================================================
            async getOrganizations() {
                await this.simulateNetworkDelay();
                const data = JSON.parse(localStorage.getItem('organizations') || '[]');
                return data;
            }

            // ========================================================================
            // INTEGRATION POINT: GET /api/organizations/:id
            // В production: заменить на fetch(`https://1c-api.moscow.ru/api/organizations/${id}`)
            // ========================================================================
            async getOrganization(id) {
                await this.simulateNetworkDelay();
                const organizations = JSON.parse(localStorage.getItem('organizations') || '[]');
                return organizations.find(org => org.id === id) || null;
            }

            // ========================================================================
            // INTEGRATION POINT: POST /api/organizations
            // В production: заменить на fetch('https://1c-api.moscow.ru/api/organizations', {method: 'POST'})
            // ========================================================================
            async createOrganization(data) {
                await this.simulateNetworkDelay();
                const organizations = JSON.parse(localStorage.getItem('organizations') || '[]');
                let nextId = parseInt(localStorage.getItem('nextOrganizationId') || '1');
                
                const newOrg = {
                    id: nextId++,
                    ...data
                };
                
                organizations.push(newOrg);
                localStorage.setItem('organizations', JSON.stringify(organizations));
                localStorage.setItem('nextOrganizationId', nextId);
                
                return newOrg;
            }

            // ========================================================================
            // INTEGRATION POINT: GET /api/policy-sections
            // В production: заменить на fetch('https://1c-api.moscow.ru/api/policy-sections')
            // ========================================================================
            async getPolicySections() {
                await this.simulateNetworkDelay();
                const data = JSON.parse(localStorage.getItem('policySections') || '[]');
                return data;
            }

            // ========================================================================
            // INTEGRATION POINT: GET /api/generated-policies
            // В production: заменить на fetch('https://1c-api.moscow.ru/api/generated-policies')
            // ========================================================================
            async getGeneratedPolicies() {
                await this.simulateNetworkDelay();
                const data = JSON.parse(localStorage.getItem('generatedPolicies') || '[]');
                return data;
            }

            // ========================================================================
            // INTEGRATION POINT: POST /api/generated-policies
            // В production: заменить на fetch('https://1c-api.moscow.ru/api/generated-policies', {method: 'POST'})
            // Здесь происходит генерация документа в системе 1С
            // ========================================================================
            async createGeneratedPolicy(data) {
                await this.simulateNetworkDelay(1500); // Имитация обработки документа в 1С
                const policies = JSON.parse(localStorage.getItem('generatedPolicies') || '[]');
                let nextId = parseInt(localStorage.getItem('nextPolicyId') || '1');
                
                const newPolicy = {
                    id: nextId++,
                    ...data,
                    generatedDate: new Date().toISOString().split('T')[0],
                    status: 'draft'
                };
                
                policies.push(newPolicy);
                localStorage.setItem('generatedPolicies', JSON.stringify(policies));
                localStorage.setItem('nextPolicyId', nextId);
                
                return newPolicy;
            }

            // Имитация сетевой задержки для реалистичности
            simulateNetworkDelay(ms = 300) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            // ========================================================================
            // Фильтрация разделов политики по параметрам организации
            // Бизнес-логика соответствия разделов типу учета и отрасли
            // ========================================================================
            filterApplicableSections(sections, organization) {
                return sections.filter(section => {
                    // Проверка типа учета
                    const accountingTypeMatch = organization.accountingType === 'budget' 
                        ? section.budgetAccounting 
                        : section.businessAccounting;
                    
                    if (!accountingTypeMatch) return false;
                    
                    // Проверка отраслевой специфики
                    if (section.industrySpecific && section.industries) {
                        if (!organization.industry) return false;
                        return section.industries.includes(organization.industry);
                    }
                    
                    return true;
                });
            }
        }

        // ============================================================================
        // APPLICATION LOGIC
        // ============================================================================

        const api = new MockAPI();
        let currentStep = 0;
        let wizardData = {
            selectedOrganizationId: null,
            applicableSections: [],
            selectedSectionIds: []
        };

        // Инициализация приложения
        async function initApp() {
            renderHome();
        }

        // Главная страница
        function renderHome() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="home-content">
                    <h2>Добро пожаловать в цифровой конструктор учётных политик</h2>
                    <p>Автоматизированная система создания стандартизированных учётных политик для государственных организаций города Москвы</p>
                    
                    <div class="feature-grid">
                        <div class="feature-item">
                            <h3>⚡ Быстро</h3>
                            <p>Создание политики за 5 минут вместо недель ручной работы</p>
                        </div>
                        <div class="feature-item">
                            <h3>🎯 Точно</h3>
                            <p>Автоматический подбор разделов по типу учета и отрасли</p>
                        </div>
                        <div class="feature-item">
                            <h3>✅ Соответствие</h3>
                            <p>Полное соответствие нормативным документам Москвы</p>
                        </div>
                        <div class="feature-item">
                            <h3>🔄 Интеграция</h3>
                            <p>Готовность к работе с системами 1С города Москвы</p>
                        </div>
                    </div>

                    <div class="api-note">
                        <strong>🔌 Для разработчиков:</strong> Система готова к интеграции с реальными API. 
                        Все точки интеграции помечены в коде как INTEGRATION POINT с примерами подключения к 1С.
                    </div>

                    <div class="nav-links">
                        <button class="nav-btn" onclick="startWizard()" data-testid="button-start-wizard">
                            🚀 Создать учётную политику
                        </button>
                        <button class="nav-btn" onclick="viewPolicies()" data-testid="button-view-policies">
                            📋 Мои политики
                        </button>
                    </div>
                </div>
            `;
        }

        // Запуск мастера
        async function startWizard() {
            currentStep = 0;
            wizardData = {
                selectedOrganizationId: null,
                applicableSections: [],
                selectedSectionIds: []
            };
            await renderWizard();
        }

        // Рендер мастера
        async function renderWizard() {
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <div class="wizard-progress">
                    <div class="wizard-step ${currentStep >= 0 ? 'active' : ''} ${currentStep > 0 ? 'completed' : ''}" data-testid="wizard-step-1">
                        <div class="wizard-step-circle">1</div>
                        <div class="wizard-step-label">Организация</div>
                    </div>
                    <div class="wizard-step ${currentStep >= 1 ? 'active' : ''} ${currentStep > 1 ? 'completed' : ''}" data-testid="wizard-step-2">
                        <div class="wizard-step-circle">2</div>
                        <div class="wizard-step-label">Разделы</div>
                    </div>
                    <div class="wizard-step ${currentStep >= 2 ? 'active' : ''} ${currentStep > 2 ? 'completed' : ''}" data-testid="wizard-step-3">
                        <div class="wizard-step-circle">3</div>
                        <div class="wizard-step-label">Выбор</div>
                    </div>
                    <div class="wizard-step ${currentStep >= 3 ? 'active' : ''} ${currentStep > 3 ? 'completed' : ''}" data-testid="wizard-step-4">
                        <div class="wizard-step-circle">4</div>
                        <div class="wizard-step-label">Готово</div>
                    </div>
                </div>
                
                <div id="wizard-content">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Загрузка...</p>
                    </div>
                </div>
            `;

            await renderCurrentStep();
        }

        async function renderCurrentStep() {
            const content = document.getElementById('wizard-content');
            
            switch(currentStep) {
                case 0:
                    await renderStep1(content);
                    break;
                case 1:
                    await renderStep2(content);
                    break;
                case 2:
                    await renderStep3(content);
                    break;
                case 3:
                    await renderStep4(content);
                    break;
            }
        }

        // Шаг 1: Выбор организации
        async function renderStep1(content) {
            const organizations = await api.getOrganizations();
            
            content.innerHTML = `
                <div class="step-content active">
                    <h2 class="step-title">Шаг 1: Выберите организацию</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Организация</label>
                        <select class="form-select" id="organization-select" data-testid="select-organization">
                            <option value="">-- Выберите организацию --</option>
                            ${organizations.map(org => `
                                <option value="${org.id}" data-testid="option-organization-${org.id}">
                                    ${org.name}
                                </option>
                            `).join('')}
                        </select>
                    </div>

                    <div id="organization-details"></div>

                    <div class="wizard-actions">
                        <button class="btn btn-secondary" onclick="renderHome()" data-testid="button-back">
                            ← Назад
                        </button>
                        <button class="btn btn-primary" id="next-btn" disabled onclick="nextStep()" data-testid="button-next">
                            Далее →
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('organization-select').addEventListener('change', async (e) => {
                const orgId = parseInt(e.target.value);
                if (orgId) {
                    wizardData.selectedOrganizationId = orgId;
                    const org = await api.getOrganization(orgId);
                    showOrganizationDetails(org);
                    document.getElementById('next-btn').disabled = false;
                } else {
                    wizardData.selectedOrganizationId = null;
                    document.getElementById('organization-details').innerHTML = '';
                    document.getElementById('next-btn').disabled = true;
                }
            });
        }

        function showOrganizationDetails(org) {
            const details = document.getElementById('organization-details');
            details.innerHTML = `
                <div class="info-box" data-testid="organization-details">
                    <strong>Информация об организации:</strong><br>
                    <strong>ИНН:</strong> ${org.inn}<br>
                    <strong>КПП:</strong> ${org.kpp}<br>
                    <strong>Тип учёта:</strong> ${org.accountingType === 'budget' ? 'Бюджетный' : 'Бухгалтерский'}<br>
                    ${org.industry ? `<strong>Отрасль:</strong> ${org.industry}<br>` : ''}
                    <strong>Централизованная бухгалтерия:</strong> ${org.centralizedOffice}
                </div>
            `;
        }

        // Шаг 2: Применимые разделы
        async function renderStep2(content) {
            const organization = await api.getOrganization(wizardData.selectedOrganizationId);
            const allSections = await api.getPolicySections();
            const applicableSections = api.filterApplicableSections(allSections, organization);
            
            wizardData.applicableSections = applicableSections;
            
            content.innerHTML = `
                <div class="step-content active">
                    <h2 class="step-title">Шаг 2: Применимые разделы</h2>
                    
                    <div class="info-box">
                        <strong>Организация:</strong> ${organization.name}<br>
                        <strong>Найдено применимых разделов:</strong> ${applicableSections.length} из ${allSections.length}
                    </div>

                    <div id="sections-list" data-testid="sections-list">
                        ${applicableSections.map(section => `
                            <div class="section-card" data-testid="section-card-${section.id}">
                                <div class="section-header">
                                    <span class="section-number">${section.sectionNumber}</span>
                                    <span class="section-title">${section.title}</span>
                                    ${section.budgetAccounting ? '<span class="badge badge-budget">Бюджетный</span>' : ''}
                                    ${section.businessAccounting ? '<span class="badge badge-accounting">Бухгалтерский</span>' : ''}
                                    ${section.industrySpecific ? '<span class="badge badge-industry">Отраслевой</span>' : ''}
                                </div>
                                <div class="section-content">${section.content.substring(0, 200)}...</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="wizard-actions">
                        <button class="btn btn-secondary" onclick="prevStep()" data-testid="button-back">
                            ← Назад
                        </button>
                        <button class="btn btn-primary" onclick="nextStep()" data-testid="button-next">
                            Далее →
                        </button>
                    </div>
                </div>
            `;
        }

        // Шаг 3: Выбор разделов
        async function renderStep3(content) {
            const organization = await api.getOrganization(wizardData.selectedOrganizationId);
            
            // Автоматически выбираем все применимые разделы
            if (wizardData.selectedSectionIds.length === 0) {
                wizardData.selectedSectionIds = wizardData.applicableSections.map(s => s.id);
            }
            
            content.innerHTML = `
                <div class="step-content active">
                    <h2 class="step-title">Шаг 3: Выберите разделы для включения</h2>
                    
                    <div class="info-box">
                        <strong>Организация:</strong> ${organization.name}<br>
                        <strong>Выбрано разделов:</strong> <span id="selected-count">${wizardData.selectedSectionIds.length}</span> из ${wizardData.applicableSections.length}
                    </div>

                    <div id="sections-selection" data-testid="sections-selection">
                        ${wizardData.applicableSections.map(section => `
                            <div class="section-card ${wizardData.selectedSectionIds.includes(section.id) ? 'selected' : ''}" 
                                 id="section-${section.id}"
                                 data-testid="section-card-${section.id}">
                                <label class="checkbox-container">
                                    <input type="checkbox" 
                                           value="${section.id}" 
                                           ${wizardData.selectedSectionIds.includes(section.id) ? 'checked' : ''}
                                           onchange="toggleSection(${section.id})"
                                           data-testid="checkbox-section-${section.id}">
                                    <div>
                                        <div class="section-header">
                                            <span class="section-number">${section.sectionNumber}</span>
                                            <span class="section-title">${section.title}</span>
                                        </div>
                                        <div class="section-content">${section.content.substring(0, 150)}...</div>
                                    </div>
                                </label>
                            </div>
                        `).join('')}
                    </div>

                    <div class="wizard-actions">
                        <button class="btn btn-secondary" onclick="prevStep()" data-testid="button-back">
                            ← Назад
                        </button>
                        <button class="btn btn-primary" onclick="nextStep()" data-testid="button-generate">
                            Сгенерировать →
                        </button>
                    </div>
                </div>
            `;
        }

        function toggleSection(sectionId) {
            const index = wizardData.selectedSectionIds.indexOf(sectionId);
            const card = document.getElementById(`section-${sectionId}`);
            
            if (index > -1) {
                wizardData.selectedSectionIds.splice(index, 1);
                card.classList.remove('selected');
            } else {
                wizardData.selectedSectionIds.push(sectionId);
                card.classList.add('selected');
            }
            
            document.getElementById('selected-count').textContent = wizardData.selectedSectionIds.length;
        }

        // Шаг 4: Результат
        async function renderStep4(content) {
            // Показываем загрузку во время генерации
            content.innerHTML = `
                <div class="step-content active">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Генерация учётной политики в системе 1С...</p>
                        <p style="font-size: 0.9rem; color: #94a3b8;">Обработка документа и сохранение в базе данных</p>
                    </div>
                </div>
            `;

            // Создаем политику (имитация отправки в 1С)
            const policy = await api.createGeneratedPolicy({
                organizationId: wizardData.selectedOrganizationId,
                selectedSections: wizardData.selectedSectionIds
            });

            const organization = await api.getOrganization(wizardData.selectedOrganizationId);
            const selectedSections = wizardData.applicableSections.filter(s => 
                wizardData.selectedSectionIds.includes(s.id)
            );

            content.innerHTML = `
                <div class="step-content active">
                    <div class="success-icon">✓</div>
                    <h2 class="step-title" style="text-align: center;">Учётная политика успешно создана!</h2>
                    
                    <div class="summary-card" data-testid="policy-summary">
                        <div class="summary-row">
                            <span class="summary-label">ID Политики:</span>
                            <span class="summary-value" data-testid="policy-id">#${policy.id}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Организация:</span>
                            <span class="summary-value" data-testid="policy-organization">${organization.name}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Дата создания:</span>
                            <span class="summary-value" data-testid="policy-date">${policy.generatedDate}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Разделов включено:</span>
                            <span class="summary-value" data-testid="policy-sections-count">${selectedSections.length}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Статус:</span>
                            <span class="summary-value" data-testid="policy-status">Черновик</span>
                        </div>
                    </div>

                    <div class="policy-preview" data-testid="policy-preview">
                        <h3>Предварительный просмотр документа</h3>
                        <h2 style="text-align: center; margin: 20px 0;">
                            УЧЁТНАЯ ПОЛИТИКА<br>
                            ${organization.name}
                        </h2>
                        <p><strong>Дата утверждения:</strong> ${policy.generatedDate}</p>
                        <p><strong>Тип учёта:</strong> ${organization.accountingType === 'budget' ? 'Бюджетный' : 'Бухгалтерский'}</p>
                        ${organization.industry ? `<p><strong>Отрасль:</strong> ${organization.industry}</p>` : ''}
                        <p><strong>Централизованная бухгалтерия:</strong> ${organization.centralizedOffice}</p>
                        
                        <h3>Включённые разделы:</h3>
                        ${selectedSections.map(section => `
                            <div style="margin: 20px 0; padding: 15px; background: #f8fafc; border-radius: 8px;">
                                <h4 style="color: #1e3a8a; margin-bottom: 10px;">
                                    ${section.sectionNumber}. ${section.title}
                                </h4>
                                <p style="white-space: pre-line;">${section.content}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div class="wizard-actions">
                        <button class="btn btn-secondary" onclick="renderHome()" data-testid="button-home">
                            ← На главную
                        </button>
                        <button class="btn btn-primary" onclick="downloadPolicy(${policy.id})" data-testid="button-download">
                            📥 Скачать PDF
                        </button>
                    </div>
                </div>
            `;
        }

        // Просмотр созданных политик
        async function viewPolicies() {
            const app = document.getElementById('app');
            const policies = await api.getGeneratedPolicies();
            const organizations = await api.getOrganizations();

            app.innerHTML = `
                <h2 class="step-title">Созданные учётные политики</h2>
                
                ${policies.length === 0 ? `
                    <div class="info-box" style="text-align: center;">
                        <p>Пока не создано ни одной учётной политики.</p>
                        <button class="btn btn-primary" onclick="startWizard()" style="margin-top: 20px;" data-testid="button-create-first">
                            Создать первую политику
                        </button>
                    </div>
                ` : `
                    <div data-testid="policies-list">
                        ${policies.map(policy => {
                            const org = organizations.find(o => o.id === policy.organizationId);
                            return `
                                <div class="section-card" data-testid="policy-card-${policy.id}">
                                    <div class="section-header">
                                        <span class="section-number">#${policy.id}</span>
                                        <span class="section-title">${org ? org.name : 'Неизвестная организация'}</span>
                                        <span class="badge badge-industry">${policy.status === 'draft' ? 'Черновик' : 'Утверждено'}</span>
                                    </div>
                                    <div class="section-content">
                                        <strong>Дата создания:</strong> ${policy.generatedDate}<br>
                                        <strong>Разделов:</strong> ${policy.selectedSections.length}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `}

                <div class="wizard-actions">
                    <button class="btn btn-secondary" onclick="renderHome()" data-testid="button-back">
                        ← Назад
                    </button>
                    <button class="btn btn-primary" onclick="startWizard()" data-testid="button-create-new">
                        + Создать новую
                    </button>
                </div>
            `;
        }

        // Навигация по шагам
        async function nextStep() {
            currentStep++;
            await renderWizard();
        }

        async function prevStep() {
            currentStep--;
            await renderWizard();
        }

        // ========================================================================
        // INTEGRATION POINT: Скачивание PDF
        // В production: запрос к 1С для генерации PDF документа
        // Endpoint: POST /api/generated-policies/:id/export-pdf
        // ========================================================================
        function downloadPolicy(policyId) {
            alert(`В production версии здесь будет скачивание PDF документа из системы 1С.\n\nEndpoint: POST /api/policies/${policyId}/export-pdf\n\nДокумент будет сгенерирован в формате, соответствующем стандартам учётной политики города Москвы.`);
        }

        // Запуск приложения
        initApp();
    </script>
</body>
</html>
